<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sign In or Create Account</title>
  <link rel="stylesheet" href="/signinpage.css">
  <link rel="stylesheet" href="/landingpage.css">
  <link rel="icon" href="" type="image/png">
  <link href="https://fonts.googleapis.com/css2?family=Irish+Grover&display=swap" rel="stylesheet">
</head>
<body>

    <header>
        <nav class="navbar">
            <a href="landingpage.html" class="logo">
                <img src="images/logo.png" alt="ClosetCrush Logo">
            </a>
            <ul class="nav-links">
              <li><a href="tops.html">Tops</a></li>
              <li><a href="bottoms.html">Bottoms</a></li>
              <li><a href="dresses.html">Dresses</a></li>
              <li><a href="shoes.html">Shoes</a></li>
              <li><a href="accessories.html">Accessories</a></li>
            </ul>
            <div class="right-section">
                <a href="wishlist.html" class="add-button">+</a>
                <button class="my-crushes">My Crushes</button>
                <img src="images/profile.png" alt="User Icon" class="user-icon">
              </div>   
        </nav>
    </header>

    <div class="container">
        <h2>Welcome, Please Select an Option</h2>
        <div class="toggle-buttons">
            <button id="show-signin">Sign In</button>
            <button id="show-signup">Create Account</button>
        </div>

        <!-- Sign-In Form -->
        <form id="signin-form" class="form-section hidden">
            <label for="signin-email">Email or Username:</label>
            <input type="text" id="signin-email" required>

            <label for="signin-password">Password:</label>
            <input type="password" id="signin-password" required>

            <button type="submit">Sign In</button>
        </form>

        <!-- Sign-Up Form -->
        <form id="signup-form" class="form-section hidden">
            <label for="name">Full Name:</label>
            <input type="text" id="name" required>

            <label for="signup-email">Email:</label>
            <input type="email" id="signup-email" required>

            <label for="signup-username">Username:</label>
            <input type="text" id="signup-username" required>

            <label for="signup-password">Password:</label>
            <input type="password" id="signup-password" required>

            <label for="confirm-password">Confirm Password:</label>
            <input type="password" id="confirm-password" required>

            <label for="skin-color">Skin Color:</label>
            <select id="skin-color">
                <option value="fair">Fair</option>
                <option value="medium">Medium</option>
                <option value="dark">Dark</option>
            </select>

            <label for="hair-color">Hair Color:</label>
            <select id="hair-color">
                <option value="black">Black</option>
                <option value="brown">Brown</option>
                <option value="blonde">Blonde</option>
                <option value="red">Red</option>
                <option value="other">Other</option>
            </select>

            <label for="background">Choose Your Background:</label>
            <div class="background-options">
                <label>
                    <input type="radio" name="background" value="bg1.jpg" checked>
                    <img src="images/backgrounds/finalcheetahbckgrnd.jpeg" alt="Background 1" class="bg-preview">
                </label>
                <label>
                    <input type="radio" name="background" value="bg2.jpg">
                    <img src="images/backgrounds/finalcleanbckgrnd.png" alt="Background 2" class="bg-preview">
                </label>
                <label>
                    <input type="radio" name="background" value="bg3.jpg">
                    <img src="images/backgrounds/finalhangerbckgrnd.png" alt="Background 3" class="bg-preview">
                </label>
            </div>

            <button type="submit">Create Account</button>
        </form>

        <p id="message"></p>
    </div>

    <!-- JavaScript at the End -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const signinForm = document.getElementById("signin-form");
            const signupForm = document.getElementById("signup-form");
            const signinButton = document.getElementById("show-signin");
            const signupButton = document.getElementById("show-signup");
            const messageElement = document.getElementById("message");

            // Initially hide both forms
            signinForm.classList.add("hidden");
            signupForm.classList.add("hidden");

            // Show sign-in form initially
            signinForm.classList.remove("hidden");

            // Show sign-in form and hide sign-up form
            signinButton.addEventListener("click", function () {
                signinForm.classList.remove("hidden");
                signupForm.classList.add("hidden");
                messageElement.textContent = ""; // Clear any messages
            });

            // Show sign-up form and hide sign-in form
            signupButton.addEventListener("click", function () {
                signupForm.classList.remove("hidden");
                signinForm.classList.add("hidden");
                messageElement.textContent = ""; // Clear any messages
            });

            // Handle sign-in form submission
            signinForm.addEventListener("submit", async function (event) {
                event.preventDefault(); // Prevent default form submission behavior
                
                const email = document.getElementById("signin-email").value;
                const password = document.getElementById("signin-password").value;
                
                // You can add password validation in a production app
                
                try {
                    const response = await fetch('/users/findOrCreate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ email }),
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        // Store user ID in localStorage for later use
                        localStorage.setItem('userId', data.user._id);
                        localStorage.setItem('userEmail', data.user.email);
                        
                        messageElement.textContent = "Sign-in successful! Redirecting...";
                        messageElement.style.color = "green";
                        
                        // Redirect to landing page after a short delay
                        setTimeout(() => {
                            window.location.href = "landingpage.html";
                        }, 1000);
                    } else {
                        messageElement.textContent = data.error || "Sign-in failed. Please try again.";
                        messageElement.style.color = "red";
                    }
                } catch (error) {
                    console.error('Error during sign-in:', error);
                    messageElement.textContent = "An error occurred. Please try again.";
                    messageElement.style.color = "red";
                }
            });

            // Handle sign-up form submission
            signupForm.addEventListener("submit", async function (event) {
                event.preventDefault(); // Prevent default form submission behavior
                
                const name = document.getElementById("name").value;
                const email = document.getElementById("signup-email").value;
                const username = document.getElementById("signup-username").value;
                const password = document.getElementById("signup-password").value;
                const confirmPassword = document.getElementById("confirm-password").value;
                const skinColor = document.getElementById("skin-color").value;
                const hairColor = document.getElementById("hair-color").value;
                const backgroundRadios = document.getElementsByName("background");
                let background = "";
                
                // Get selected background
                for (let i = 0; i < backgroundRadios.length; i++) {
                    if (backgroundRadios[i].checked) {
                        background = backgroundRadios[i].value;
                        break;
                    }
                }
                
                // Basic client-side validation
                if (password !== confirmPassword) {
                    messageElement.textContent = "Passwords do not match!";
                    messageElement.style.color = "red";
                    return;
                }
                
                try {
                    const response = await fetch('/users/findOrCreate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ 
                            email,
                            name,
                            username,
                            skinColor,
                            hairColor,
                            background
                            // Password would be hashed on the server in a real app
                        }),
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        // Store user ID in localStorage for later use
                        localStorage.setItem('userId', data.user._id);
                        localStorage.setItem('userEmail', data.user.email);
                        
                        messageElement.textContent = "Account created successfully! Redirecting...";
                        messageElement.style.color = "green";
                        
                        // Redirect to landing page after a short delay
                        setTimeout(() => {
                            window.location.href = "landingpage.html";
                        }, 1000);
                    } else {
                        messageElement.textContent = data.error || "Account creation failed. Please try again.";
                        messageElement.style.color = "red";
                    }
                } catch (error) {
                    console.error('Error during sign-up:', error);
                    messageElement.textContent = "An error occurred. Please try again.";
                    messageElement.style.color = "red";
                }
            });
        });
    </script>

</body>
</html>