<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="">
  <meta name="description" content="">
  <title>My Bottoms</title>
  <link rel="stylesheet" href="items.css">
  <link rel="icon" href="" type="image/png">
  <!-- Irish Grover font -->
  <link href="https://fonts.googleapis.com/css2?family=Irish+Grover&display=swap" rel="stylesheet">
</head>
<body>
  <header>
    <nav class="navbar">
        <a href="landingpage.html" class="logo">
            <img src="images/logo.png" alt="ClosetCrush Logo">
        </a>
        <ul class="nav-links">
          <li><a href="tops.html">Tops</a></li>
          <li><a href="bottoms.html">Bottoms</a></li>
          <li><a href="dresses.html">Dresses</a></li>
          <li><a href="shoes.html">Shoes</a></li>
          <li><a href="accessories.html">Accesories</a></li>
        </ul>
        <div class="right-section">
            <a href="wishlist.html" class="add-button">+</a>
            <button class="my-crushes">My Crushes</button>
            <img src="images/profile.png" alt="User Icon" class="user-icon">
          </div>   
    </nav>
  </header>

  <!-- Generic container for items -->
  <div class="items-container">
    <h1 class="items-title">Bottoms</h1>
    
    <!-- Items grid - will be populated dynamically -->
    <div id="items-grid" class="items-grid">
      <!-- Loading indicator -->
      <div id="loading-indicator" class="loading-indicator">
        Loading your bottoms...
      </div>
      
      <!-- Empty state message (hidden by default) -->
      <div id="empty-state" class="empty-state" style="display: none;">
        <p>You don't have any bottoms yet.</p>
        <a href="wishlist.html" class="add-item-link">Add some items</a>
      </div>
      
      <!-- Error message (hidden by default) -->
      <div id="error-message" class="error-message" style="display: none;">
        There was a problem loading your items. Please try again.
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <div class="footer-logo">
        <img src="images/logo.png" alt="ClosetCrush Logo">
    </div>
    <p>Â© 2025 SL, JK, HH & AH. All Rights Reserved</p>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Check if user is logged in
      const userId = localStorage.getItem('userId');
      if (!userId) {
        // Redirect to sign-in page if no user is logged in
        window.location.href = "/signin";
        return;
      }
      
      // Load user's bottoms
      loadUserItems(userId, 'bottoms');
    });
    
    async function loadUserItems(userId, category) {
      const itemsGrid = document.getElementById('items-grid');
      const loadingIndicator = document.getElementById('loading-indicator');
      const emptyState = document.getElementById('empty-state');
      const errorMessage = document.getElementById('error-message');
      
      try {
        // Fetch user's items
        const response = await fetch(`/users/${userId}/items`);
        
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        
        const data = await response.json();
        
        // Hide loading indicator
        loadingIndicator.style.display = 'none';
        
        // Check if there are items in this category
        if (!data[category] || data[category].length === 0) {
          emptyState.style.display = 'block';
          return;
        }
        
        // Display items
        data[category].forEach(filename => {
          // Extract information from filename (format: brand_category_timestamp.png)
          const filenameParts = filename.split('_');
          
          // Create item card
          const itemCard = document.createElement('div');
          itemCard.className = 'item-card';
          
          // Create image container
          const itemImage = document.createElement('div');
          itemImage.className = 'item-image';
          itemImage.style.backgroundImage = `url(images/${filename})`;
          
          // Create date added element
          const nameElement = document.createElement('p');
          nameElement.className = 'name';
          nameElement.textContent = `Added: ${new Date(parseInt(filenameParts[2])).toLocaleDateString()}`;
          
          // Add elements to card
          itemCard.appendChild(itemImage);
          itemCard.appendChild(nameElement);
          
          // Add delete button
          const deleteButton = document.createElement('button');
          deleteButton.className = 'delete-button';
          deleteButton.innerHTML = '&times;';
          deleteButton.setAttribute('aria-label', 'Delete item');
          deleteButton.addEventListener('click', (e) => {
            e.stopPropagation();
            deleteItem(userId, category, filename, itemCard);
          });
          
          itemCard.appendChild(deleteButton);
          
          // Add card to grid
          itemsGrid.appendChild(itemCard);
        });
        
      } catch (error) {
        console.error('Error loading items:', error);
        loadingIndicator.style.display = 'none';
        errorMessage.style.display = 'block';
      }
    }
    
    async function deleteItem(userId, category, filename, itemCard) {
      if (!confirm('Are you sure you want to delete this item?')) {
        return;
      }
      
      try {
        const response = await fetch(`/users/${userId}/deleteItem`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            category,
            filename
          }),
        });
        
        const data = await response.json();
        
        if (data.success) {
          // Remove the item card from the grid
          itemCard.remove();
          
          // Check if there are any items left
          const itemsGrid = document.getElementById('items-grid');
          if (itemsGrid.children.length === 3) { // Loading indicator, empty state, and error divs
            document.getElementById('empty-state').style.display = 'block';
          }
        } else {
          alert('Failed to delete item: ' + (data.error || 'Unknown error'));
        }
      } catch (error) {
        console.error('Error deleting item:', error);
        alert('Failed to delete item. Please try again.');
      }
    }
  </script>
</body>
</html>